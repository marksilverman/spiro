<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style type="text/css">
        canvas {
            border: 1px solid black;
            margin: 10px;
        }
        html, body, button {
            margin: 2px;
            font-family: monospace;
            font-size: 20px;
        }
    </style>
    <title>Spiromaniac</title>
</head>

<body onload="main();">
    <p>
        <div id="msg"></div>
        <table id="table">
            <tr>
                <td>
                    <label>radius1:</label>
                    <input tabindex="1" type="number" id="radius1" onchange="(function () { spiro.radius1 = Number.parseInt(value); })();">
                </td>
                <td>
                    <div class="slidecontainer">
                        speed
                        <input tabindex="-1" type="range" min="0" max="50" value="20" class="slider" id="speed"
                               oninput="(function(){spiro.speed = value / 200;})();">
                    </div>
                </td>
                <td>
                    <div class="slidecontainer">
                        rotate
                        <input tabindex="-1" type="range" min="0" max="20" value="10" class="slider" id="rotate"
                               oninput="(function(){spiro.rotateSpeed = value / 100;})();">
                    </div>
                </td>
                <td>
                        <div class="slidecontainer">
                        maxoffset
                        <input tabindex="-1" type="range" min="0" max="10" value="2" class="slider" id="maxoffset"
                               oninput="(function(){ spiro.maxOffset = value; })();">
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <label>radius2:</label>
                    <input tabindex="2" type="number" id="radius2" onchange="(function () { spiro.radius2 = Number.parseInt(value); })();">
                </td>
                <td>
                    <div class="slidecontainer">
                        loops
                        <input tabindex="-1" type="range" min="1" max="100" value="10" class="slider" id="loops"
                               oninput="(function(){spiro.loops = value;})();">
                    </div>
                </td>
                <td>
                    <div class="slidecontainer">
                        width
                        <input tabindex="-1" type="range" min="1" max="20" value="3" class="slider" id="width"
                               oninput="(function(){spiro.width = value;})();">
                    </div>
                </td>
                <td><button tabindex="-1" onclick="randomize()">randomize</button></td>
            </tr>
            <tr>
                <td>
                    <label>radius3:</label>
                    <input tabindex="3" type="number" id="radius3" onchange="(function () { spiro.radius3 = Number.parseInt(value); })();">
                </td>
                <td>
                    <div class="slidecontainer">
                        scale
                        <input tabindex="-1" type="range" min="1" max="50" value="40" class="slider" id="scale"
                               oninput="(function(){ spiro.scale = value; })();">
                    </div>
                </td>
                <td>
                    <div class="slidecontainer">
                        blur
                        <input tabindex="-1" type="range" min="10" max="100" value="80" class="slider" id="blur"
                               oninput="(function(){ spiro.blur = 1 - value / 100; })();">
                    </div>
                </td>
                <td><button tabindex="-1" id="pause" onclick="pause()">pause</button></td>
                <td></td>
            </tr>
        </table>
        <canvas id="canvas"></canvas>
        <div id="msg"></div>
    </p>
    <script>
        // -9, -6, -1
        // 6, -2, 8
        // -7, -4, -1
        // 7, -2, -6
        // 5, 6, -1
        // -7, -4, 2
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        var ww = window.innerWidth * .6;
        var hh = window.innerHeight * .8;
        var raf = 0, fgcolor, bgcolor;
        canvas.width = ww;
        canvas.height = hh;

        var spiro = {
            radius1: -7,
            radius2: -4,
            radius3: -1,
            scale: 40, speed: 0.04, blur: 0.2, width: 3, offset: 0.0, maxOffset: 2,
            rotateSpeed: 0.01, rotateAngle: 0.0, loops: 10, x:-1, y:-1,
            draw: function () {
                ctx.save()
                ctx.translate(ww / 2, hh / 2);
                ctx.rotate(this.rotateAngle);
                ctx.beginPath();

                var tooBig = false;
                for (let angle1 = 0.0; angle1 < this.loops * 2 * Math.PI; angle1 += 0.005) {
                    var angle2 = angle1 * (this.radius1 - this.radius2) / this.radius2;
                    var angle3 = angle2 * (this.radius1 - this.radius2 + this.radius3) / this.radius3;

                    this.x = (this.radius1 - this.radius2 + this.radius3) * Math.cos(angle1);
                    this.x += (this.radius3 - this.radius2) * Math.cos(angle2);
                    this.x += this.offset * this.radius3 * Math.cos(angle3);
                    this.x *= this.scale;

                    this.y = (this.radius1 - this.radius2 + this.radius3) * Math.sin(angle1);
                    this.y -= (this.radius3 - this.radius2) * Math.sin(angle2);
                    this.y -= this.offset * this.radius3 * Math.sin(angle3);
                    this.y *= this.scale;
                    if (this.y > hh / 2) tooBig = true;
                    if (angle1 == 0)
                        ctx.moveTo(this.x, this.y);
                    else
                        ctx.lineTo(this.x, this.y);
                }
                if (tooBig)
                    this.scale -= 0.25;
                document.getElementById("scale").value = this.scale;
                ctx.lineWidth = this.width;

                rr = Math.floor(Math.random() * 55);
                gg = Math.floor(Math.random() * 55);
                bb = Math.floor(Math.random() * 55);
                ctx.strokeStyle = fgcolor;
                ctx.stroke();

                ctx.restore();
            }
        };

        function msg(info) { document.getElementById("msg").innerHTML = info; }

        function randomize() {
            spiro.radius1 = spiro.radius2 = spiro.radius3 = 0;
            while (spiro.radius1 == 0)
                spiro.radius1 = Math.round(10 - Math.random() * 20);
            while (spiro.radius2 == 0 || spiro.radius2 == radius1)
                spiro.radius2 = Math.round(10 - Math.random() * 20);
            while (spiro.radius3 == 0 || spiro.radius3 == spiro.radius2 || spiro.radius3 == spiro.radius1)
                spiro.radius3 = Math.round(10 - Math.random() * 20);
            document.getElementById("radius1").value = spiro.radius1;
            document.getElementById("radius2").value = spiro.radius2;
            document.getElementById("radius3").value = spiro.radius3;
            document.getElementById("scale").value = spiro.scale = 20;
            newColors();
            if (!raf) pause();
        }
        function pause() {
            if (raf) {
                window.cancelAnimationFrame(raf);
                document.getElementById("pause").innerHTML = "unpause";
                raf = 0;
            }
            else {
                document.getElementById("pause").innerHTML = "pause";
                draw();
            }
        }
        function newColors() {
            rr = Math.floor(Math.random() * 155) + 100;
            gg = Math.floor(Math.random() * 155) + 100;
            bb = Math.floor(Math.random() * 155) + 100;
            bgcolor = 'rgba(' + rr + ',' + gg + ',' + bb + ',';

            rr = Math.floor(Math.random() * 55);
            gg = Math.floor(Math.random() * 55);
            bb = Math.floor(Math.random() * 55);
            fgcolor = 'rgba(' + rr + ',' + gg + ',' + bb + ')';
        }

        function main() {
            document.getElementById("radius1").value = Number.parseFloat(spiro.radius1).toPrecision(2);
            document.getElementById("radius2").value = Number.parseFloat(spiro.radius2).toPrecision(2);
            document.getElementById("radius3").value = Number.parseFloat(spiro.radius3).toPrecision(2);
            document.getElementById("speed").value = 200 * spiro.speed;
            document.getElementById("scale").value = spiro.scale;
            document.getElementById("rotate").value = 100 * spiro.rotateSpeed;
            document.getElementById("width").value = spiro.width;
            document.getElementById("blur").value = 100 - 100 * spiro.blur;
            newColors();
            draw();
        }
        function show() {
            msg("x: " + spiro.x + ", y: " + spiro.y);
        }
        function draw() {
            ctx.fillStyle = bgcolor + spiro.blur + ')';
            ctx.fillRect(0, 0, ww, hh);

            spiro.draw();
            if (Math.abs(spiro.offset) > spiro.maxOffset)
                spiro.speed = spiro.speed * -1;
            spiro.offset += spiro.speed;
            spiro.rotateAngle += spiro.rotateSpeed;
            raf = window.requestAnimationFrame(draw);
        }

    </script>
</body>
</html>