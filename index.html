<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Spiromaniac</title>

    <script type="text/javascript">
        // interesting presets:
        // 10, -2, 6
        // 5, 7, -1
        // -6, 2, 8
        // 3, -5, 4
        // 8, 3, 5
        let ww = window.innerWidth * .6;
        let hh = window.innerHeight * .8;
        let radius1 = 3, radius2 = -5, radius3 = 4;
        let intervalID = 0, scale = 10, speed = 0.04, globalColor = 0, line_width = 3, noise = 0;
        let offset = 0.0, rotateAngle = 0.0, rotateSpeed = 0.01, loops = 10, factor = 200;
        var canvas, ctx;

        function msg(info) { document.getElementById("msg").innerHTML = info; }

        function nextColor()
        {
            globalColor += 0xffff;
            if (globalColor > 0xffffff)
                globalColor -= 0xffffff;
            // return '#' + globalColor.toString(16);
        }

        function draw() {
            canvas.width = ww;
            canvas.height = hh;

            var colorString = '#' + globalColor.toString(16);
            var gradient = ctx.createRadialGradient(ww * .5, hh * .5, ww / 2, ww * .5, hh * .5, ww / 8);
            gradient.addColorStop(0, colorString);
            gradient.addColorStop(1, 'white');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, ww, hh);

            ctx.translate(ww / 2, hh / 2);
            ctx.beginPath();
            ctx.rotate(rotateAngle);
            rotateAngle += rotateSpeed;

            for (let angle1 = 0.0; angle1 < loops * 2 * Math.PI; angle1 += 0.005) {
                var angle2 = angle1 * (radius1 - radius2) / radius2;
                var angle3 = angle2 * (radius2 - radius3) / radius3;

                var x = (radius1 - radius2) * Math.cos(angle1);
                x += (radius2 - radius3) * Math.cos(angle2);
                x += radius3 * offset * Math.cos(angle3);
                x += noise * Math.cos(angle1) * Math.cos(angle2);
                x *= scale;

                var y = (radius1 - radius2) * Math.sin(angle1);
                y -= (radius2 - radius3) * Math.sin(angle2);
                y -= offset * radius3 * Math.sin(angle3);
                y -= noise * Math.sin(angle1) * Math.sin(angle2);
                y *= scale;

                if (angle1 == 0)
                    ctx.moveTo(x, y);
                else
                    ctx.lineTo(x, y);
            }
            ctx.lineWidth = line_width;
            ctx.stroke();
            if (Math.abs(offset) > 2)
                speed = speed * -1;
            offset += speed;
        }
        function setup() {
            canvas = document.getElementById('spiro');
            ctx = canvas.getContext('2d');
            globalColor = Math.floor(Math.random() * 0xffffff);
            document.getElementById("radius1").value = Number.parseFloat(radius1).toPrecision(2);
            document.getElementById("radius2").value = Number.parseFloat(radius2).toPrecision(2);
            document.getElementById("radius3").value = Number.parseFloat(radius3).toPrecision(2);
            intervalID = window.setInterval(draw, 20);
        }
        function pause() {
            if (intervalID) {
                window.clearInterval(intervalID);
                intervalID = 0;
                document.getElementById("pause").innerHTML = "unpause";
            }
            else {
                intervalID = window.setInterval(draw, 20);
                document.getElementById("pause").innerHTML = "pause";
            }
        }
        function randomize() {
            radius1 = radius2 = radius3 = 0;
            while (radius1 == 0)
                radius1 = Math.round(10 - Math.random() * 20);
            while (radius2 == 0 || radius2 == radius1)
                radius2 = Math.round(10 - Math.random() * 20);
            while (radius3 == 0 || radius3 == radius2 || radius3 == radius1)
                radius3 = Math.round(10 - Math.random() * 20);
            document.getElementById("radius1").value = radius1;
            document.getElementById("radius2").value = radius2;
            document.getElementById("radius3").value = radius3;
            nextColor();
        }
        function fullScreen()
        {
            t = document.getElementById("table");
            if (t.style.display == "none")
            {
                t.style.display = "block";
                ww = window.innerWidth * 0.6;
                hh = window.innerHeight * 0.8;
            }
            else
            {
                t.style.display = "none";
                ww = window.innerWidth;
                hh = window.innerHeight;
            }
        }

    </script>

    <style type="text/css">
        canvas {
            border: 1px solid black;
            margin: 10px;
        }

        html, body, button {
            margin: 2px;
            font-family: monospace;
            font-size: 20px;
        }
    </style>
</head>

<body onload="setup();">
    <p>
        <div id="msg"></div>
        <table id="table">
            <tr><td><label>radius1:</label>
                    <input  tabindex="1" type="number" id="radius1" onchange="(function () { radius1 = value; })();">
                </td>
                <td><div class="slidecontainer">speed
                        <input tabindex="-1" type="range" min="0" max="50" value="20" class="slider" id="speed"
                               oninput="(function(){speed = value / 200;})();">
                    </div></td>
                <td><div class="slidecontainer">rotation
                        <input tabindex="-1" type="range" min="0" max="40" value="10" class="slider" id="rotate"
                               oninput="(function(){rotateSpeed = value / 200;})();">
                    </div></td>
                <td><button tabindex="-1" onclick="randomize()">randomize</button></td>
            </tr>
            <tr><td><label>radius2:</label>
                    <input tabindex="2" type="number" id="radius2" onchange="(function () { radius2 = value; })();">
                </td>
                <td><div class="slidecontainer">loops
                        <input tabindex="-1" type="range" min="1" max="100" value="10" class="slider" id="loops"
                               oninput="(function(){loops = value;})();">
                    </div></td>
                <td><div class="slidecontainer">width
                        <input tabindex="-1" type="range" min="1" max="20" value="3" class="slider"
                               oninput="(function(){line_width = value;})();">
                    </div></td>
                <td><button tabindex="-1" id="pause" onclick="pause()">pause</button></td>
            </tr>
            <tr><td><label>radius3:</label>
                    <input tabindex="3" type="number" id="radius3" onchange="(function () { radius3 = value; })();">
                </td>
                <td><div class="slidecontainer">scale
                        <input tabindex="-1" type="range" min="1" max="50" value="10" class="slider" id="scale"
                               oninput="(function(){ scale = value; })();">
                    </div></td>
                <td><div class="slidecontainer">noise
                        <input tabindex="-1" type="range" min="0" max="40" value="0" class="slider" id="noise"
                               oninput="(function(){ noise = value; })();">
                    </div></td>
                    <td></td>
                    <td></td>
            </tr>
        </table>
    </p>
    <canvas id="spiro" width=1500 height=800></canvas>
<br><button tabindex="-1" id="full screen" onclick="fullScreen()">full screen</button>
</body>
</html>
